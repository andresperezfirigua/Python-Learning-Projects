function GetSearchValue() {
    if ([string]::IsNullOrWhiteSpace($textboxSearch.Text)) {
        [System.Windows.Forms.MessageBox]::Show("Debe ingresar un equipo para buscar", "Error", "OK", "Error")
        return $null
    }
    $searchToUpper = $textboxSearch.Text.ToUpper()
    return $searchToUpper
}

function GetTipoRegistro() {
    if ($radioIngreso.Checked) {
        return "Ingreso"
    }
    elseif ($radioRetiro.Checked) {
        return "Retiro"
    }
    return $null
}

function GetOutputWorkbook($outputFilePath) {
    $outputFile = New-Object -ComObject Excel.Application
    $outputWorkbook = $outputFile.Workbooks.Open($outputFilePath)
    return $outputWorkbook
}

function AddRecord() {
    # Load the Excel file into a variable
    # $inputFilePath = "C:\Users\andresfelipe.perez\Downloads\alm_hardware.xlsx"
    # $outputFilePath = "C:\Users\andresfelipe.perez\Downloads\Minuta_computadores.xlsx"
    $inputFilePath = "C:\Users\Peter.Cadwell\Downloads\alm_hardware.xlsx"
    $outputFilePath = "C:\Users\Peter.Cadwell\Downloads\Minuta_computadores.xlsx"

    $searchValue = GetSearchValue
    if (!$searchValue) {
        return
    }

    $inputFile = New-Object -ComObject Excel.Application
    $workbook = $inputFile.Workbooks.Open($inputFilePath)
    $worksheet = $workbook.Sheets.Item(1)
    $lastRow = $worksheet.UsedRange.Rows.Count

    $date = Get-Date
    $dateString = $date.ToString("yyyy-MM-dd HH:mm:ss")

    $tipoRegistro = GetTipoRegistro

    $isFound = $false

    # Loop through each row in the worksheet, starting from row 1
    for ($i = 1; $i -le $lastRow; $i++) {
        # Check if the current row contains the search value
        if ($worksheet.Cells.Item($i, 1).Value2 -eq $searchValue  -or $worksheet.Cells.Item($i, 2).Value2 -eq $searchValue) {
            # If the search value is found, get the values in the row and copy them to the output worksheet
            $isFound = $true
            $bearer = $worksheet.Cells.Item($i, 3).Value2

            $outputWorkbook = GetOutputWorkbook($outputFilePath)
            $outputWorksheet = $outputWorkbook.Sheets.Item(1)

            # Get the last row of data in the output worksheet
            $outputLastRow = $outputWorksheet.UsedRange.Rows.Count

            # Copy the values from the input worksheet to the output worksheet
            for ($j = 1; $j -le $worksheet.UsedRange.Columns.Count; $j++) {
                $outputWorksheet.Cells.Item($outputLastRow + 1, $j).Value2 = $worksheet.Cells.Item($i, $j).Value2
            }

            # Add the current date/time to the next cell